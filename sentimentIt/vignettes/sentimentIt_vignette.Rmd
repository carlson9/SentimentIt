---
title: "SentimentIt"
author: ""
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{sentimentIt_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This is a tutorial on how to use the SentimentIt R package. SentimentIt provides a pairwise comparison framework for fast, flexible, and reliable human coding of political texts.

###Probably want to include some background on SentimentIt here###


Create the necessary accounts
------

Before interacting with the package in R, go to the following link: https://www.sentimentit.com/documentation/getting_started. The manual attached to the link explains how to create the necessary accounts with Amazon and SentimentIt so you can interact with Mechanical Turk. A SentimentIt account MUST be created before the SentimentIt R package can be used. 


Install/load the SentimentIt R package
------

Once the five steps of the SentimentIt manual are completed, install the SentimentIt package in R using the following command:

```{r, eval = FALSE}
install.packages("SentimentIt")

#or if the package is already installed
library("SentimentIt")
```


Assign ID numbers to data objects
------

Once the package is installed, you need to prepare your data for the pairwise comparisons. The first step is to assign unique ID numbers to each object of comparison using the `readText()` function. 

The `readText()` function will take the data as an input, import it into the SentimentIt repository, and assign unique ID values to each object in the data. The function will then export the data to a specified file path, complete with ID numbers. If any objects already exist in the repository, the ID number for the existing object will be used instead of importing a duplicate.

Your data should contain the set of objects you want to perform pairwise comparisons on. It may contain other data as well, but you will need to specify which column contains the data to be used in the pairwise comparisons. The best practice for running this function is to first import your data into your R workspace before running the function.

The following example uses a sample dataset, "reviews.rda", to show how to use the `readText()` function to assign unique ID numbers

```{r, eval = FALSE}
load("/Users/johndoe/Desktop/reviews.rda") #data is stored in R workspace as "reviews"

#assign an object name to the function so the data with IDs will be stored in your R workspace in addition to being exported to your desired filepath. In this case, I have assigned the output the name "reviews_with_ids"
reviews_with_ids <- readText(email = "johndoe@school.edu", password = "12345",
         read_documents_from = reviews,
         write_documents_to = "/Users/johndoe/Desktop/reviews_with_ids.csv",
         index = "Review") #"Review" is the column name for the data I want to use in the comparison
```

`readText()` accepts the following arguments:

-   `email`: Character vector, the email address for the registered SentimentIt account.

-   `password`: Character vector, the password associated with `email`.

-   `read_documents_from`: The name of the R object the data is being drawn from. Can also be a character vector  indicating a filepath.

-   `write_documents_to`: The file path to write the `read_documents_from` object appended with the unique IDs. Default is NULL and the results will not be saved, but only returned. For best functionality specify a csv.

-   `index`: If the data is tabular, this field should contain either a character vector or integer identifying the column name of the data to be used in the comparisons. Default is `NULL`, indicating the text was not sent in tabular format.

-   `sep`: Argument passed to `read.table()` function. If using an R workspace object, do not edit this field. Default is line break. Only needed when index is not `NULL`.

-   `what`: Argument passed to `scan()` function. Default is character. Only needed when index is NULL.

-   `quiet`: Argument passed to `scan()` function. Default is TRUE. Only needed when index is NULL.

-   `...`: Additional arguments passed to either `scan()` or `read.table()` depending on type of data used.


Generate random pairs of IDs for comparisons
------

At this point, the data with unique IDs should be stored both in your R workspace and in the filepath you specified in `readText()`. The next step is to create unique batch ID numbers. Each batch ID number will be associated with a "batch",
which contains a portion of all comparisons to be sent to Mechanical Turk. Instead of sending all comparisons to Mechanical Turk at once, you can decide to release each batch at your discretion. 

To create unique batch ID numbers, use the `createBatches()` function. Before using this function, you should have set up HIT settings on the SentimentIt website. You will need to provide the ID number of the specific HIT settings you would like to use for the comparisons.

```{r, eval = FALSE}


batch_ids <- createBatches(email = "johndoe@school.edu", password = "12345",
              task_setting_id = 28, num_batches = 3)
```

`createBatches()` accepts the following arguments:

-   `email`: Character vector, the email address for the registered SentimentIt account.

-   `password`: Character vector, the password associated with `email`.

-   `task_setting_id`: Integer vector, the ID number of the HIT settings you would like to use for these batches of comparisons.

-   `num_batches`: Integer vector, the number of separate batches in which you would like to send the comparisons to Mechanical Turk. Default to 1. 


Fill batches with comparisons
------

At this point, you should have run both the `readText()` and `createBatches()` functions and you should have data with unique IDs. You should also have as many unique batch IDs as the number of batches you would like to send out the comparisons in. The next step is to fill these batches with random pairings of your data objects. Each batch you send to Mechanical Turk will contain these random pairings and MTurk workers will compare some latent trait between the paired objects.

To generate these random pairings, run the `makeComps()` function, which will generate random pairings of your data objects and distribute them evenly among the number of batches you specify. Before running this function, you should have your unique batch ID numbers stored in your R workspace and you should have decided what quality you want to compare between the paired objects, which should be specified in the `question` input.

```{r, eval = FALSE}

makeComps(email = "johndoe@school.edu", password = "12345",
             ids = reviews_ids[,3], number_per = 10,
             batch_id = batch_ids,
             question = "Below are two movie reviews. Identify which review you think is more positive.",
             pairwise_path = "comparisons.Rdata")
```

`makeComps()` accepts the following arguments:

-   `email`: Character vector, the email address for the registered SentimentIt account.

-   `password`: Character vector, the password associated with `email`.

-   `ids`: Integer vector, the ID numbers of the texts you want to use.

-   `number_per`: Integer vector, how many documents per batch to be compared.

-   `batch_id`: 

-   `question`: Character vector, the question the worker will see when comparing the texts.

-   `pairwise_path`: Character vector, the filepath to save the created pairwise matrix. Default is "pairwise.Rdata".



